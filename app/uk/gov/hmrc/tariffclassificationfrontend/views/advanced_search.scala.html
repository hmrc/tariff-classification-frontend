@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.tariffclassificationfrontend.config.AppConfig
@import uk.gov.hmrc.tariffclassificationfrontend.controllers
@import uk.gov.hmrc.tariffclassificationfrontend.models.{Case, Search}
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.forms.components.{input_checkbox, input_text}
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.includes.main
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.partials.{advanced_search_keywords, advanced_search_results}
@(form: Form[Search], results: Option[Seq[Case]] = None, keywords: Seq[String])(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@main(bodyClasses = None) {
 <h1 id="advanced_search-heading" class="heading-xlarge">Advanced Search</h1>

 <h2 class="heading-medium">Enter search terms</h2>
 <hr class="mt-0"/>

 @helper.form(action = controllers.routes.SearchController.search(), 'id -> "advanced_search-form") {
  @input_text(
   field = form("trader_name"),
   label = "Trader name",
   formControlClass = Some("w-75")
  )

  @input_text(
   field = form("commodity_code"),
   label = "Commodity code",
   formControlClass = Some("w-75")
  )

  @input_text(
   field = form("decision_details"),
   label = "Ruling details",
   hint = Some("Searches the Ruling Goods Description, justification and the Commercial Denomination"),
   formControlClass = Some("w-75")
  )

  @advanced_search_keywords(form, keywords)


  <button id="advanced_search-search_button" class="button" type="submit">Search</button>
  <a id="advanced_search-reset_button" class="secondary-button" href="@controllers.routes.SearchController.search()">New Search</a>

  @if(results.isEmpty) {
   @*
    Hack to ensure the checkbox is checked when search results aren't present
    This is only required for form elements that are rendered when results are present and which need a default value.
   *@
      <input type="hidden" value="true" name="live_rulings_only"/>
  }

  @if(results.isDefined) {
   <div id="advanced_search-results_and_filters" class="grid-row mt-1">

    <div class="column-one-quarter">
     <h3 class="heading-medium">Filter search</h3>
     <hr class="mt-0"/>

     @input_checkbox(
      field = form("live_rulings_only"),
      label = "Live rulings only",
      submitOnChange = true
     )
    </div>

    @defining(results.get.filter(_.application.isBTI)) { searchResults: Seq[Case] =>
     <div class="column-three-quarters">
      <h3 class="heading-medium" id="advanced_search-results_heading">Showing @{searchResults.size} @if(searchResults.size == 1){case}@if(searchResults.size != 1){cases}</h3>
      <hr class="mt-0"/>
      @advanced_search_results(searchResults)
     </div>
    }

   </div>
  }
 }

}
