@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.tariffclassificationfrontend.config.AppConfig
@import uk.gov.hmrc.tariffclassificationfrontend.controllers
@import uk.gov.hmrc.tariffclassificationfrontend.controllers.SessionKeys
@import uk.gov.hmrc.tariffclassificationfrontend.models.{Paged, Search}
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.forms.components.{input_checkbox, input_text}
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.includes.main
@import uk.gov.hmrc.tariffclassificationfrontend.views.html.partials.{advanced_search_keywords, advanced_search_results_tabs, back_link, pagination}
@import uk.gov.hmrc.tariffclassificationfrontend.views.partials.SearchResult
@(form: Form[Search], results: Option[Paged[SearchResult]] = None, keywords: Seq[String], selectedTab: String)(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@main(bodyClasses = None) {

 @back_link(displayBackLink = true, SessionKeys.backToQueuesLinkUrl, SessionKeys.backToQueuesLinkLabel)

 <h1 id="advanced_search-heading" class="heading-xlarge">Advanced search</h1>

 <h2 class="heading-large">Enter search terms</h2>
 <hr class="mt-0"/>

 @helper.form(action = controllers.routes.SearchController.search(selectedTab), 'id -> "advanced_search-form") {
  @input_text(
   field = form("trader_name"),
   label = "Trader name",
   formControlClass = Some("w-75")
  )

  @input_text(
   field = form("commodity_code"),
   label = "Commodity code",
   formControlClass = Some("w-75")
  )

  @input_text(
   field = form("decision_details"),
   label = "Ruling details",
   hint = Some("Search the goods description, justification and the commercial denomination"),
   formControlClass = Some("w-75")
  )

  @advanced_search_keywords(form, keywords)


  <button id="advanced_search-search_button" class="button" type="submit">Search</button>
  <a id="advanced_search-reset_button" class="secondary-button" href="@controllers.routes.SearchController.search(selectedTab)">New search</a>

  @if(results.isEmpty) {
   @*
    Hack to ensure the checkbox is checked when search results aren't present
    This is only required for form elements that are rendered when results are present and which need a default value.
   *@
      <input type="hidden" value="true" name="live_rulings_only"/>
  }

  @if(results.isDefined && !form.hasErrors) {
   <div id="advanced_search-results_and_filters" class="mt-3">

    <h2 class="heading-large">Search Results</h2>

    <div class="grid-row">
     <div class="column-one-quarter">
      <p>Filter your results:</p>

      <div class="advanced_search--filters_container">
       <div class="advanced_search--filters_heading">
        Cases to include
       </div>
       <div class="advanced_search--filters">
       @input_checkbox(
        field = form("live_rulings_only"),
        label = "Live rulings only",
        submitOnChange = true
       )
       </div>
      </div>


     </div>


     @defining(results.get) { searchResults: Paged[SearchResult] =>
      <div class="column-three-quarters">

       @pagination(
        id = "advanced_search-pagination_top",
        singularName = "case",
        pluralName = "cases",
        pager = searchResults,
        containerClass = Some("mb-2"),
        onChange = page => controllers.routes.SearchController.search(selectedTab, search = form.get, page = page)
       )

       @advanced_search_results_tabs(searchResults, selectedTab)

       @pagination(
        id = "advanced_search-pagination_bottom",
        singularName = "case",
        pluralName = "cases",
        pager = searchResults,
        containerClass = Some("mt-2"),
        onChange = page => controllers.routes.SearchController.search(selectedTab, search = form.get, page = page)
       )

      </div>
     }
    </div>

   </div>
  }
 }

}
